import{d as F,N as M,r as k,c as R,y as W,J as G,e as o,O as H,o as _,f as L,g as e,h as s,w as a,A as f,m as w,v as b,j as u,F as K,q as Q,t as X,B as S,z as Y,V as Z,R as g,W as ee}from"./index-9436cd64.js";import{u as te}from"./setting-0de6a771.js";const re=F({__name:"index",setup(ae){const c=M();let I=te(),m=k(0),t=R({attrName:"",attrValueList:[],categoryId:"",categoryLevel:3});const h=k(),y=()=>{m.value=0},V=()=>{m.value=1,t.categoryId=c.c3Id,t.attrName="",t.attrValueList=[]},B=l=>{V(),Object.assign(t,JSON.parse(JSON.stringify(l)))},O=()=>{t.attrValueList.push({valueName:""}),Y(()=>{var l;(l=h.value)==null||l.focus()})},D=async()=>{try{await Z(t),g.success(t.id?"修改成功":"添加成功"),y(),I.updateRefresh()}catch{g.error(t.id?"修改失败":"添加失败")}},z=()=>{y()},U=(l,p)=>{if(!l.valueName.trim()){g.error("属性值不能为空"),t.attrValueList.splice(p,1);return}t.attrValueList.find(r=>{if(r!=l)return r.valueName==l.valueName})&&(g.error("属性值重复"),t.attrValueList.splice(p,1))},q=l=>{t.attrValueList.splice(l,1)},E=async l=>{await ee(l.id),setTimeout(()=>{c.getAttrArr()},50);try{g.success("删除成功")}catch{}};return W(()=>c.c3Id,()=>{c.getAttrArr()}),G(()=>{c.getAttrArr()}),(l,p)=>{const A=o("Category"),r=o("el-button"),i=o("el-table-column"),J=o("el-tag"),P=o("el-popconfirm"),N=o("el-table"),C=o("el-input"),T=o("el-form-item"),$=o("el-form"),j=o("el-card"),v=H("has");return _(),L("div",null,[e(A,{scene:s(m)},null,8,["scene"]),e(j,{shadow:"hover"},{default:a(()=>[f(w("div",null,[f((_(),b(r,{type:"primary",icon:"Plus",disabled:!s(c).c3Id,onClick:V},{default:a(()=>[u(" 添加属性 ")]),_:1},8,["disabled"])),[[v,"btn.Attr.add"]]),e(N,{border:"",style:{margin:"10px 0"},data:s(c).attrArr},{default:a(()=>[e(i,{label:"序号",align:"center",type:"index",width:"80px"}),e(i,{label:"属性名称",align:"center",width:"180px",prop:"attrName"}),e(i,{label:"属性值名称",align:"center"},{default:a(({row:n})=>[(_(!0),L(K,null,Q(n.attrValueList,d=>(_(),b(J,{key:d.id,style:{margin:"5px"}},{default:a(()=>[u(X(d.valueName),1)]),_:2},1024))),128))]),_:1}),e(i,{label:"操作",align:"center",width:"200px"},{default:a(({row:n})=>[f(e(r,{type:"warning",size:"small",icon:"Edit",onClick:d=>B(n)},null,8,["onClick"]),[[v,"btn.Attr.update"]]),f((_(),b(P,{title:"确定要删除当前的属性吗? ",width:"220px",icon:"Warning",onConfirm:d=>E(n)},{reference:a(()=>[e(r,{type:"danger",size:"small",icon:"Delete"})]),_:2},1032,["onConfirm"])),[[v,"btn.Attr.remove"]])]),_:1})]),_:1},8,["data"])],512),[[S,s(m)==0]]),f(w("div",null,[e($,null,{default:a(()=>[e(T,{label:"属性名称",style:{width:"300px"}},{default:a(()=>[e(C,{modelValue:s(t).attrName,"onUpdate:modelValue":p[0]||(p[0]=n=>s(t).attrName=n),placeholder:"请输入属性名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{type:"primary",icon:"Plus",disabled:!s(t).attrName.trim(),onClick:O},{default:a(()=>[u(" 添加属性值 ")]),_:1},8,["disabled"]),e(r,{onClick:y},{default:a(()=>[u("取消")]),_:1}),e(N,{border:"",style:{margin:"10px 0"},data:s(t).attrValueList},{default:a(()=>[e(i,{label:"序号",align:"center",type:"index",width:"80px"}),e(i,{label:"属性值",align:"center"},{default:a(({row:n,$index:d})=>[e(C,{placeholder:"请你输入属性值名称",modelValue:n.valueName,"onUpdate:modelValue":x=>n.valueName=x,onBlur:x=>U(n,d),ref_key:"attrValueInput",ref:h},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1}),e(i,{label:"操作",align:"center"},{default:a(({$index:n})=>[e(r,{type:"danger",size:"small",icon:"Delete",onClick:d=>q(n)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),e(r,{type:"primary",onClick:D,disabled:!(s(t).attrValueList.length>0)},{default:a(()=>[u(" 保存 ")]),_:1},8,["disabled"]),e(r,{onClick:z},{default:a(()=>[u("取消")]),_:1})],512),[[S,s(m)==1]])]),_:1})])}}});export{re as default};
