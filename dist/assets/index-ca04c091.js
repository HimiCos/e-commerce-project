import{M as y,d as ie,r as i,N as de,c as ce,u as me,J as pe,e as c,O as ve,o as _,f as M,g as l,w as t,h as s,P as F,Q as fe,j as d,A as S,v as h,n as ge,F as _e,q as we,t as be,z as K,R as w,S as he,_ as ye}from"./index-9436cd64.js";const Ce=(u,m,R)=>y.get(`/admin/acl/user/${u}/${m}/?username=${R}`),Ue=u=>u.id?y.put("/admin/acl/user/update",u):y.post("/admin/acl/user/save",u),xe=u=>y.get("/admin/acl/user/toAssign/"+u),Ve=u=>y.post("/admin/acl/user/doAssignRole",u),ke=u=>y.delete("/admin/acl/user/remove/"+u),Se=u=>y.delete("/admin/acl/user/batchRemove",{data:u}),Re=ie({__name:"index",setup(u){const m=i(1),R=i(0),q=de(),L=i([]);let C=i("");const U=i(!1);let n=ce({username:"",name:"",password:""}),j=i(""),z=i();const W=me(),V=i(!1);let x=i([]),v=i([]);const $=i(!1),N=i(!1);let E=i([]);pe(()=>{f()});const f=async(o=1)=>{m.value=o;let e=await Ce(m.value,q.limit,C.value);e.code==200&&(R.value=e.data.total,L.value=e.data.records)},J=()=>{C.value="",f()},Q=()=>{U.value=!0,Object.assign(n,{id:0,username:"",name:"",password:""}),K(()=>{z.value.clearValidate()})},B=o=>{U.value=!0,Object.assign(n,o),j.value=o.username,K(()=>{z.value.clearValidate()})},G=async()=>{try{await z.value.validate()}catch{return}(await Ue(n)).code==200?(w.success(n.id?"更新成功":"添加成功"),U.value=!1,f(n.id?m.value:1),j.value==W.username&&window.location.reload()):w.error(n.id?"更新失败":"添加失败")},H=()=>{U.value=!1},X={username:[{required:!0,trigger:"blur",validator:(o,e,r)=>{e.trim().length>=5?r():r(new Error("用户名称长度至少五位"))}}],name:[{required:!0,trigger:"blur",validator:(o,e,r)=>{e.trim().length>=5?r():r(new Error("用户昵称长度至少五位"))}}],password:[{required:!0,trigger:"blur",validator:(o,e,r)=>{e.trim().length>=6?r():r(new Error("用户密码长度至少六位"))}}]},Y=async o=>{Object.assign(n,o);let e=await xe(n.id);e.code==200&&(x.value=e.data.allRolesList,v.value=e.data.assignRoles,V.value=!0),v.value.length>0&&v.value.length<x.value.length&&(N.value=!0)},Z=o=>{o?(v.value=x.value,N.value=!1):v.value=[]},ee=o=>{const e=o.length;$.value=e===x.value.length,N.value=e>0&&e<x.value.length},le=async()=>{let o={userId:n.id,roleIdList:v.value.map(r=>r.id)};(await Ve(o)).code==200?(w.success("分配角色成功"),V.value=!1,f(m.value)):w.error("分配角色失败")},te=async o=>{(await ke(o.id)).code==200?(w.success("删除用户成功"),f(m.value)):w.error("删除用户失败")},ae=o=>{E.value=o},oe=async()=>{let o=E.value.map(r=>r.id);(await Se(o)).code==200?(w.success("批量删除用户成功"),f(m.value)):w.error("批量删除用户失败")},ne=()=>{he("Limit",q.limit),f()};return(o,e)=>{const r=c("el-input"),b=c("el-form-item"),p=c("el-button"),I=c("el-form"),D=c("el-card"),O=c("el-popconfirm"),g=c("el-table-column"),re=c("el-table"),se=c("el-pagination"),P=c("el-drawer"),T=c("el-checkbox"),ue=c("el-checkbox-group"),k=ve("has");return _(),M("div",null,[l(D,{style:{height:"74px","margin-bottom":"10px"},shadow:"hover"},{default:t(()=>[l(I,{class:"form",inline:!0},{default:t(()=>[l(b,{label:"用户名: "},{default:t(()=>[l(r,{placeholder:"请输入搜索的用户名",modelValue:s(C),"onUpdate:modelValue":e[0]||(e[0]=a=>F(C)?C.value=a:C=a),onKeyup:e[1]||(e[1]=fe(a=>f(),["enter"]))},null,8,["modelValue"])]),_:1}),l(b,null,{default:t(()=>[l(p,{type:"primary",onClick:e[2]||(e[2]=a=>f())},{default:t(()=>[d("搜索")]),_:1}),l(p,{type:"warning",onClick:J},{default:t(()=>[d("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(D,{shadow:"hover"},{default:t(()=>[S((_(),h(p,{type:"primary",onClick:Q},{default:t(()=>[d(" 添加 ")]),_:1})),[[k,"btn.User.add"]]),l(O,{width:"220px",icon:"Warning",title:"确定要删除选中的用户吗",onConfirm:oe},{reference:t(()=>[S((_(),h(p,{type:"danger",disabled:!s(E).length},{default:t(()=>[d(" 批量删除 ")]),_:1},8,["disabled"])),[[k,"btn.User.remove"]])]),_:1}),l(re,{onSelectionChange:ae,border:"",style:{margin:"10px 0"},data:L.value},{default:t(()=>[l(g,{type:"selection",align:"center"}),l(g,{label:"#",type:"index",align:"center"}),l(g,{label:"id",width:"62px",align:"center",prop:"id"}),l(g,{label:"用户名称",width:"130px",align:"center",prop:"username","show-overflow-tooltip":""}),l(g,{label:"用户昵称",width:"84px",align:"center",prop:"name","show-overflow-tooltip":""}),l(g,{label:"用户角色",width:"84px",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(g,{label:"创建时间",width:"125px",align:"center",prop:"createTime","show-overflow-tooltip":""}),l(g,{label:"更新时间",width:"130px",align:"center",prop:"updateTime","show-overflow-tooltip":""}),l(g,{label:"操作",width:"300px",align:"center",fixed:"right"},{default:t(({row:a})=>[S((_(),h(p,{type:"success",icon:"User",size:"small",onClick:A=>Y(a)},{default:t(()=>[d(" 分配角色 ")]),_:2},1032,["onClick"])),[[k,"btn.User.assgin"]]),S((_(),h(p,{type:"primary",icon:"Edit",size:"small",onClick:A=>B(a)},{default:t(()=>[d(" 编辑 ")]),_:2},1032,["onClick"])),[[k,"btn.User.update"]]),l(O,{width:"240px",icon:"Warning",title:"确定要删除当前的用户吗? ",onConfirm:A=>te(a)},{reference:t(()=>[S((_(),h(p,{type:"danger",icon:"Delete",size:"small"},{default:t(()=>[d(" 删除 ")]),_:1})),[[k,"btn.User.remove"]])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),l(se,{"current-page":m.value,"onUpdate:currentPage":e[3]||(e[3]=a=>m.value=a),"page-size":s(q).limit,"onUpdate:pageSize":e[4]||(e[4]=a=>s(q).limit=a),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:R.value,onCurrentChange:e[5]||(e[5]=a=>f(m.value)),onSizeChange:ne},null,8,["current-page","page-size","total"])]),_:1}),l(P,{modelValue:U.value,"onUpdate:modelValue":e[9]||(e[9]=a=>U.value=a),title:s(n).id?"编辑用户":"添加用户"},{footer:t(()=>[l(p,{onClick:H},{default:t(()=>[d("取消")]),_:1}),l(p,{type:"primary",onClick:G},{default:t(()=>[d("确认")]),_:1})]),default:t(()=>[l(I,{model:s(n),rules:X,ref_key:"formRef",ref:z},{default:t(()=>[l(b,{label:"用户名称",prop:"username"},{default:t(()=>[l(r,{placeholder:"请填写用户名称",modelValue:s(n).username,"onUpdate:modelValue":e[6]||(e[6]=a=>s(n).username=a)},null,8,["modelValue"])]),_:1}),l(b,{label:"用户昵称",prop:"name"},{default:t(()=>[l(r,{placeholder:"请填写用户昵称",modelValue:s(n).name,"onUpdate:modelValue":e[7]||(e[7]=a=>s(n).name=a)},null,8,["modelValue"])]),_:1}),s(n).id?ge("",!0):(_(),h(b,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[l(r,{placeholder:"请填写用户密码",modelValue:s(n).password,"onUpdate:modelValue":e[8]||(e[8]=a=>s(n).password=a)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(P,{modelValue:V.value,"onUpdate:modelValue":e[13]||(e[13]=a=>V.value=a),title:"分配角色用户"},{footer:t(()=>[l(p,{onClick:e[12]||(e[12]=a=>V.value=!1)},{default:t(()=>[d("取消")]),_:1}),l(p,{type:"primary",onClick:le},{default:t(()=>[d("确定")]),_:1})]),default:t(()=>[l(I,null,{default:t(()=>[l(b,{label:"用户名称"},{default:t(()=>[l(r,{disabled:"",placeholder:s(n).username},null,8,["placeholder"])]),_:1}),l(b,{label:"角色列表"},{default:t(()=>[l(T,{onChange:Z,modelValue:$.value,"onUpdate:modelValue":e[10]||(e[10]=a=>$.value=a),indeterminate:N.value},{default:t(()=>[d(" 全选 ")]),_:1},8,["modelValue","indeterminate"]),l(ue,{modelValue:s(v),"onUpdate:modelValue":e[11]||(e[11]=a=>F(v)?v.value=a:v=a),onChange:ee},{default:t(()=>[(_(!0),M(_e,null,we(s(x),(a,A)=>(_(),h(T,{key:A,label:a},{default:t(()=>[d(be(a.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});const $e=ye(Re,[["__scopeId","data-v-94b27690"]]);export{$e as default};
