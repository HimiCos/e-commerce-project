import{M as $,d as Z,r as _,U as de,e as o,o as b,f as D,g as e,w as t,h as u,F as H,q as O,v as R,P as X,m as ee,j as q,t as ie,A as L,B as j,R as x,z as ce,c as pe,Y as me,_ as _e,N as ge,y as fe,J as Se,O as ve,S as be}from"./index-9436cd64.js";const ke=(v,A,k)=>$.get(`/admin/product/${v}/${A}?category3Id=${k}`),le=()=>$.get("/admin/product/baseTrademark/getTrademarkList"),ae=v=>$.get("/admin/product/spuImageList/"+v),ne=v=>$.get("/admin/product/spuSaleAttrList/"+v),te=()=>$.get("/admin/product/baseSaleAttrList"),ye=v=>v.id?$.post("/admin/product/updateSpuInfo",v):$.post("/admin/product/saveSpuInfo",v),Ve=v=>$.post("/admin/product/saveSkuInfo",v),Ie=v=>$.get("/admin/product/findBySpuId/"+v),Ae=v=>$.delete("/admin/product/deleteSpu/"+v),Ue=["src"],he=Z({__name:"spuForm",emits:["changeScene0"],setup(v,{expose:A,emit:k}){let f=_([]),I=_([]),y=_([]),r=_([]),d=_({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),N=_(!1),K=_(""),h=_([]),U=_("");const T=()=>{k("changeScene0",{flag:0,params:d.value.id?"update":"add"})},w=async s=>{d.value=s;let l=await le(),a=await ae(s.id),V=await ne(s.id),P=await te();f.value=l.data,I.value=a.data.map(z=>({name:z.imgName,url:z.imgUrl})),y.value=V.data,r.value=P.data},i=async s=>{Object.assign(d.value,{category3Id:"",spuName:"",description:"",id:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),I.value=[],y.value=[],U.value="",d.value.category3Id=s;let l=await le(),a=await te();f.value=l.data,r.value=a.data},p=s=>{K.value=s.url,N.value=!0},g=s=>{const l=s.type==="image/jpeg",a=s.type==="image/png",V=s.type==="image/gif",P=s.size/1024/1024<2;return!l&&!a&&!V&&x.error("上传图片只能是 JPG/PNG/GIF 格式!"),P||x.error("上传图片大小不能超过 2MB!"),(l||a||V)&&P},C=(s,l)=>{s.flag=!0,s.saleAttrValue="",ce(()=>{h.value[l].focus()})},B=s=>{s.flag=!1;const{baseSaleAttrId:l,saleAttrValue:a}=s;let V={baseSaleAttrId:l,saleAttrValueName:a};if(a.trim()==""){x.error("属性值名称不能为空");return}if(s.spuSaleAttrValueList.some(z=>z.saleAttrValueName===a)){x.error("属性值名称重复");return}s.spuSaleAttrValueList.push(V)},F=de(()=>r.value.filter(l=>y.value.every(a=>l.name!==a.saleAttrName))),m=()=>{const[s,l]=U.value.split(":");let a={baseSaleAttrId:s,saleAttrName:l,spuSaleAttrValueList:[]};y.value.push(a),U.value=""},c=async()=>{d.value.spuImageList=I.value.map(l=>({imgName:l.name,imgUrl:l.response&&l.response.data||l.url})),d.value.spuSaleAttrList=y.value,(await ye(d.value)).code===200?(x.success(d.value.id?"修改成功":"添加成功"),T()):x.error(d.value.id?"修改失败":"添加失败")};return A({initHasSpuData:w,initSpuData:i}),(s,l)=>{const a=o("el-input"),V=o("el-form-item"),P=o("el-option"),z=o("el-select"),J=o("Plus"),W=o("el-icon"),Y=o("el-upload"),E=o("el-dialog"),S=o("el-button"),G=o("el-table-column"),ue=o("el-tag"),oe=o("el-table"),se=o("el-form");return b(),D("div",null,[e(se,null,{default:t(()=>[e(V,{label:"SPU名称"},{default:t(()=>[e(a,{placeholder:"请输入SPU名称",modelValue:u(d).spuName,"onUpdate:modelValue":l[0]||(l[0]=n=>u(d).spuName=n)},null,8,["modelValue"])]),_:1}),e(V,{label:"SPU品牌"},{default:t(()=>[e(z,{modelValue:u(d).tmId,"onUpdate:modelValue":l[1]||(l[1]=n=>u(d).tmId=n),placeholder:"请选择品牌"},{default:t(()=>[(b(!0),D(H,null,O(u(f),n=>(b(),R(P,{key:n.id,label:n.tmName,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"SPU描述"},{default:t(()=>[e(a,{type:"textarea",placeholder:"请输入SPU的描述",modelValue:u(d).description,"onUpdate:modelValue":l[2]||(l[2]=n=>u(d).description=n)},null,8,["modelValue"])]),_:1}),e(V,{label:"SPU图片"},{default:t(()=>[e(Y,{"file-list":u(I),"onUpdate:fileList":l[3]||(l[3]=n=>X(I)?I.value=n:I=n),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":p,"before-upload":g},{default:t(()=>[e(W,null,{default:t(()=>[e(J)]),_:1})]),_:1},8,["file-list"]),e(E,{modelValue:u(N),"onUpdate:modelValue":l[4]||(l[4]=n=>X(N)?N.value=n:N=n),style:{width:"50%","border-radius":"10px"}},{default:t(()=>[ee("img",{"w-full":"",src:u(K),alt:"Preview Image",style:{width:"100%",height:"100%","border-radius":"10px"}},null,8,Ue)]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"SPU属性"},{default:t(()=>[e(z,{modelValue:u(U),"onUpdate:modelValue":l[5]||(l[5]=n=>X(U)?U.value=n:U=n),placeholder:u(F).length?`暂未选择的有${u(F).length}个`:"暂无可选项"},{default:t(()=>[(b(!0),D(H,null,O(u(F),n=>(b(),R(P,{key:n.id,label:n.name,value:`${n.id}:${n.name}`},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),e(S,{type:"primary",icon:"Plus",style:{"margin-left":"10px"},disabled:!u(U),onClick:m},{default:t(()=>[q(" 添加销售属性 ")]),_:1},8,["disabled"]),e(oe,{style:{margin:"10px 0"},border:"",data:u(y)},{default:t(()=>[e(G,{label:"序号",type:"index",width:"100px",align:"center"}),e(G,{label:"属性名",width:"150px",align:"center",prop:"saleAttrName"}),e(G,{label:"属性值",align:"center"},{default:t(({row:n,$index:Q})=>[(b(!0),D(H,null,O(n.spuSaleAttrValueList,(M,re)=>(b(),R(ue,{key:M.id,closable:"",style:{margin:"5px"},onClose:Ne=>n.spuSaleAttrValueList.splice(re,1)},{default:t(()=>[q(ie(M.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),L(e(S,{type:"success",size:"small",icon:"Plus",onClick:M=>C(n,Q)},null,8,["onClick"]),[[j,!n.flag]]),L(e(a,{onBlur:M=>B(n),size:"small",style:{width:"100px"},placeholder:"请输入属性值",ref:M=>u(h)[Q]=M,modelValue:n.saleAttrValue,"onUpdate:modelValue":M=>n.saleAttrValue=M},null,8,["onBlur","modelValue","onUpdate:modelValue"]),[[j,n.flag==!0]])]),_:1}),e(G,{label:"操作",width:"100px",align:"center"},{default:t(({$index:n})=>[e(S,{type:"danger",size:"small",icon:"Delete",onClick:Q=>u(y).splice(n,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(V,null,{default:t(()=>[e(S,{type:"primary",onClick:c,disabled:u(y).length==0},{default:t(()=>[q(" 保存 ")]),_:1},8,["disabled"]),e(S,{onClick:T},{default:t(()=>[q("取消")]),_:1})]),_:1})]),_:1})])}}}),we=["src"],Ce=Z({__name:"skuForm",emits:["changeScene0"],setup(v,{expose:A,emit:k}){let f=_([]),I=_([]),y=_([]),r=pe({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""}),d=_();const N=()=>{k("changeScene0",{flag:0,params:""})},K=async()=>{r.skuAttrValueList=f.value.reduce((i,p)=>{if(p.attrIdAndValueId){let[g,C]=p.attrIdAndValueId.split(":");i.push({attrId:g,valueId:C})}return i},[]),r.skuSaleAttrValueList=I.value.reduce((i,p)=>{if(p.saleIdAndSaleValueId){let[g,C]=p.saleIdAndSaleValueId.split(":");i.push({saleAttrId:g,saleAttrValueId:C})}return i},[]),(await Ve(r)).code==200?(x.success("添加成功"),k("changeScene0",{flag:0,params:""})):x.error("添加失败")},h=async(w,i,p)=>{Object.assign(r,{skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""}),r.category3Id=p.category3Id,r.spuId=p.id,r.tmId=p.tmId;let g=await me(w,i,p.category3Id),C=await ne(p.id),B=await ae(p.id);f.value=g.data,I.value=C.data,y.value=B.data},U=w=>{y.value.forEach(i=>{d.value.toggleRowSelection(i,!1)}),d.value.toggleRowSelection(w,!0),r.skuDefaultImg=w.imgUrl},T=w=>{r.skuDefaultImg?r.skuDefaultImg="":r.skuDefaultImg=w[0].imgUrl};return A({initSkuData:h}),(w,i)=>{const p=o("el-input"),g=o("el-form-item"),C=o("el-option"),B=o("el-select"),F=o("el-form"),m=o("el-table-column"),c=o("el-button"),s=o("el-table");return b(),D("div",null,[e(F,{"label-width":"70px"},{default:t(()=>[e(g,{label:"SKU名称"},{default:t(()=>[e(p,{placeholder:"请输入SKU名称",modelValue:u(r).skuName,"onUpdate:modelValue":i[0]||(i[0]=l=>u(r).skuName=l)},null,8,["modelValue"])]),_:1}),e(g,{label:"价格 (元)"},{default:t(()=>[e(p,{placeholder:"请输入价格 (元)",type:"number",modelValue:u(r).price,"onUpdate:modelValue":i[1]||(i[1]=l=>u(r).price=l)},null,8,["modelValue"])]),_:1}),e(g,{label:"重量 (克)"},{default:t(()=>[e(p,{placeholder:"请输入重量 (克)",type:"number",modelValue:u(r).weight,"onUpdate:modelValue":i[2]||(i[2]=l=>u(r).weight=l)},null,8,["modelValue"])]),_:1}),e(g,{label:"SKU描述"},{default:t(()=>[e(p,{type:"textarea",placeholder:"请输入SKU的描述",modelValue:u(r).skuDesc,"onUpdate:modelValue":i[3]||(i[3]=l=>u(r).skuDesc=l)},null,8,["modelValue"])]),_:1}),e(g,{label:"平台属性"},{default:t(()=>[e(F,{inline:!0},{default:t(()=>[(b(!0),D(H,null,O(u(f),l=>(b(),R(g,{key:l.id,label:l.attrName},{default:t(()=>[e(B,{placeholder:"Select",modelValue:l.attrIdAndValueId,"onUpdate:modelValue":a=>l.attrIdAndValueId=a},{default:t(()=>[(b(!0),D(H,null,O(l.attrValueList,a=>(b(),R(C,{key:a.id,label:a.valueName,value:`${l.id}:${a.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(g,{label:"销售属性"},{default:t(()=>[(b(!0),D(H,null,O(u(I),l=>(b(),R(g,{key:l.id,label:l.saleAttrName,"label-width":"43px"},{default:t(()=>[e(B,{placeholder:"Select",modelValue:l.saleIdAndSaleValueId,"onUpdate:modelValue":a=>l.saleIdAndSaleValueId=a},{default:t(()=>[(b(!0),D(H,null,O(l.spuSaleAttrValueList,a=>(b(),R(C,{key:a.id,label:a.saleAttrValueName,value:`${l.id}:${a.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1}),e(g,{label:"图片名称"},{default:t(()=>[e(s,{border:"",data:u(y),ref_key:"table",ref:d,onSelect:T},{default:t(()=>[e(m,{type:"selection",align:"center",width:"80px"}),e(m,{label:"图片",align:"center"},{default:t(({row:l})=>[ee("img",{src:l.imgUrl,style:{width:"100px"}},null,8,we)]),_:1}),q(" > "),e(m,{label:"名称",align:"center",prop:"imgName"}),e(m,{label:"操作",align:"center"},{default:t(({row:l})=>[e(c,{type:"warning",onClick:a=>U(l)},{default:t(()=>[q(" 设置默认 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(g,null,{default:t(()=>[e(c,{type:"primary",onClick:K},{default:t(()=>[q("保存")]),_:1}),e(c,{onClick:N},{default:t(()=>[q("取消")]),_:1})]),_:1})]),_:1})])}}});const Pe=_e(Ce,[["__scopeId","data-v-b6ab2a88"]]),xe=Z({__name:"index",setup(v){const A=_(0),k=_(1),f=ge(),I=_([]),y=_(0);let r=_(),d=_();const N=_([]),K=_(!1);fe(()=>f.c3Id,()=>{h()});const h=async(m=1)=>{if(f.c3Id){k.value=m;let c=await ke(k.value,f.limit,f.c3Id);c.code==200&&(I.value=c.data.records,y.value=c.data.total)}},U=m=>{A.value=m.flag,m.params=="update"&&h(k.value),m.params=="add"?h():k.value=k.value},T=()=>{A.value=1},w=()=>{A.value=2},i=m=>{w(),d.value.initSkuData(f.c1Id,f.c2Id,m)};Se(()=>{h()});const p=m=>{T(),r.value.initHasSpuData(m)},g=()=>{T(),r.value.initSpuData(f.c3Id)},C=async m=>{let c=await Ie(m.id);c.code==200&&(N.value=c.data,K.value=!0)},B=async m=>{(await Ae(m.id)).code==200?(x.success("成功删除SPU"),h(k.value)):x.error("删除SPU失败")},F=()=>{be("Limit",f.limit),h()};return(m,c)=>{const s=o("Category"),l=o("el-button"),a=o("el-table-column"),V=o("el-popconfirm"),P=o("el-table"),z=o("el-pagination"),J=o("el-image"),W=o("el-dialog"),Y=o("el-card"),E=ve("has");return b(),D("div",null,[e(s,{scene:A.value},null,8,["scene"]),e(Y,{shadow:"hover"},{default:t(()=>[L(ee("div",null,[L((b(),R(l,{type:"primary",icon:"Plus",disabled:!u(f).c3Id,onClick:g},{default:t(()=>[q(" 添加SPU ")]),_:1},8,["disabled"])),[[E,"btn.Spu.add"]]),e(P,{border:"",style:{margin:"15px 0"},data:I.value},{default:t(()=>[e(a,{label:"序号",width:"100",align:"center",type:"index"}),e(a,{label:"SPU名称",width:"180",align:"center",prop:"spuName"}),e(a,{label:"SPU描述",align:"center",prop:"description"}),e(a,{label:"操作",align:"center"},{default:t(({row:S})=>[L(e(l,{type:"primary",size:"small",icon:"Plus",title:"添加SKU",onClick:G=>i(S)},null,8,["onClick"]),[[E,"btn.Spu.addsku"]]),L(e(l,{type:"warning",size:"small",icon:"Edit",title:"修改SPU",onClick:G=>p(S)},null,8,["onClick"]),[[E,"btn.Spu.update"]]),L(e(l,{type:"info",size:"small",icon:"PieChart",title:"查看SKU列表",onClick:G=>C(S)},null,8,["onClick"]),[[E,"btn.Spu.skus"]]),e(V,{title:"确定要删除当前的SPU吗? ",width:"230px",icon:"Warning",onConfirm:G=>B(S)},{reference:t(()=>[L(e(l,{type:"danger",size:"small",icon:"Delete",title:"删除SPU"},null,512),[[E,"btn.Spu.delete"]])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),e(z,{"current-page":k.value,"onUpdate:currentPage":c[0]||(c[0]=S=>k.value=S),"page-size":u(f).limit,"onUpdate:pageSize":c[1]||(c[1]=S=>u(f).limit=S),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:y.value,onCurrentChange:c[2]||(c[2]=S=>h(k.value)),onSizeChange:F},null,8,["current-page","page-size","total"])],512),[[j,A.value==0]]),L(e(he,{ref_key:"spu",ref:r,onChangeScene0:U},null,512),[[j,A.value==1]]),L(e(Pe,{ref_key:"sku",ref:d,onChangeScene0:U},null,512),[[j,A.value==2]]),e(W,{modelValue:K.value,"onUpdate:modelValue":c[3]||(c[3]=S=>K.value=S),title:"SKU列表",width:"50%",style:{"border-radius":"10px"}},{default:t(()=>[e(P,{data:N.value,border:""},{default:t(()=>[e(a,{label:"SKU名称",align:"center",prop:"skuName"}),e(a,{label:"SKU价格",align:"center",prop:"price"}),e(a,{label:"SKU重量",align:"center",prop:"weight"}),e(a,{label:"SKU图片",align:"center"},{default:t(({row:S})=>[e(J,{style:{width:"100px"},src:S.skuDefaultImg},null,8,["src"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})])}}});export{xe as default};
