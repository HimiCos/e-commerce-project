import{M as g,d as le,r as c,N as te,c as oe,u as ae,J as ne,e as i,O as re,o as b,f as se,g as l,w as t,Q as ie,j as p,A as $,v as z,h as f,m as de,S as ue,z as I,R as k,_ as ce}from"./index-9436cd64.js";const pe=(s,d,h)=>g.get(`/admin/acl/role/${s}/${d}/?roleName=${h}`),me=s=>s.id?g.put("/admin/acl/role/update",s):g.post("/admin/acl/role/save",s),fe=s=>g.get("/admin/acl/permission/toAssign/"+s),ve=(s,d)=>g.post(`/admin/acl/permission/doAssign/?roleId=${s}&permissionId=${d}`),_e=s=>g.delete("/admin/acl/role/remove/"+s),ge={class:"dialog-footer"},ye=le({__name:"index",setup(s){const d=c(1),h=c(0),C=te(),x=c(""),A=c([]),v=c(!1);let r=oe({roleName:""}),V=c();const y=c(!1);let q=c([]),S=c([]),U=c();const O=ae(),K=()=>{ue("Limit",C.limit),m()};ne(()=>{m()});const m=async(a=1)=>{d.value=a;let e=await pe(d.value,C.limit,x.value);A.value=e.data.records,h.value=e.data.total},L=()=>{x.value="",m()},M=()=>{v.value=!0,Object.assign(r,{roleName:"",id:0}),I(()=>{V.value.clearValidate()})},T=a=>{v.value=!0,Object.assign(r,a),I(()=>{V.value.clearValidate()})},B={roleName:[{required:!0,trigger:"blur",validator:(a,e,n)=>{e.trim().length>=2?n():n(new Error("角色名称至少两位"))}}]},D=async()=>{await V.value.validate(),(await me(r)).code==200?(k.success(r.id?"更新成功":"添加成功"),v.value=!1,m(d.value)):k.error(r.id?"更新失败":"添加失败")},H=async a=>{y.value=!0,Object.assign(r,a);let e=await fe(r.id);e.code==200&&(S.value=e.data,q.value=E(S.value,[]))},E=(a,e)=>(a.forEach(n=>{n.select&&n.level==4&&e.push(n.id),n.children&&n.children.length>0&&E(n.children,e)}),e),J={children:"children",label:"name"},Q=async()=>{const a=r.id;let e=U.value.getCheckedKeys(),n=U.value.getHalfCheckedKeys(),w=e.concat(n);(await ve(a,w)).code==200&&(k.success("权限分配成功"),y.value=!1,O.roles.forEach(N=>{N==r.roleName&&window.location.reload()}))},W=async a=>{(await _e(a.id)).code==200?(k.success("删除成功"),m(d.value)):k.error("删除失败")};return(a,e)=>{const n=i("el-input"),w=i("el-form-item"),u=i("el-button"),N=i("el-form"),P=i("el-card"),_=i("el-table-column"),F=i("el-popconfirm"),G=i("el-table"),X=i("el-pagination"),Y=i("el-dialog"),Z=i("el-tree"),ee=i("el-drawer"),R=re("has");return b(),se("div",null,[l(P,{style:{height:"74px","margin-bottom":"10px"},shadow:"hover"},{default:t(()=>[l(N,{class:"form",inline:!0},{default:t(()=>[l(w,{label:"角色名称: "},{default:t(()=>[l(n,{placeholder:"请输入搜索的角色名称",onKeyup:e[0]||(e[0]=ie(o=>m(),["enter"])),modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=o=>x.value=o)},null,8,["modelValue"])]),_:1}),l(w,null,{default:t(()=>[l(u,{type:"primary",onClick:e[2]||(e[2]=o=>m())},{default:t(()=>[p("搜索")]),_:1}),l(u,{type:"warning",onClick:L},{default:t(()=>[p("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(P,{shadow:"hover"},{default:t(()=>[$((b(),z(u,{type:"primary",icon:"Plus",onClick:M},{default:t(()=>[p(" 添加角色 ")]),_:1})),[[R,"btn.Role.add"]]),l(G,{border:"",style:{margin:"10px 0"},data:A.value},{default:t(()=>[l(_,{label:"#",width:"60",type:"index",align:"center"}),l(_,{label:"id",width:"80",align:"center",prop:"id"}),l(_,{label:"角色名称",width:"150",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(_,{label:"创建时间",width:"180",align:"center",prop:"createTime","show-overflow-tooltip":""}),l(_,{label:"更新时间",width:"180",align:"center",prop:"updateTime","show-overflow-tooltip":""}),l(_,{label:"操作",align:"center"},{default:t(({row:o})=>[$((b(),z(u,{type:"success",size:"small",icon:"User",onClick:j=>H(o)},{default:t(()=>[p(" 分配权限 ")]),_:2},1032,["onClick"])),[[R,"btn.Role.assgin"]]),$((b(),z(u,{type:"primary",size:"small",icon:"Edit",onClick:j=>T(o)},{default:t(()=>[p(" 编辑 ")]),_:2},1032,["onClick"])),[[R,"btn.Role.update"]]),$((b(),z(F,{onConfirm:j=>W(o),title:"确定要删除当前的角色吗? ",width:"230px",icon:"Warning"},{reference:t(()=>[l(u,{type:"danger",size:"small",icon:"Delete"},{default:t(()=>[p(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])),[[R,"btn.Role.remove"]])]),_:1})]),_:1},8,["data"]),l(X,{"current-page":d.value,"onUpdate:currentPage":e[3]||(e[3]=o=>d.value=o),"page-size":f(C).limit,"onUpdate:pageSize":e[4]||(e[4]=o=>f(C).limit=o),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:h.value,onCurrentChange:e[5]||(e[5]=o=>m(d.value)),onSizeChange:K},null,8,["current-page","page-size","total"])]),_:1}),l(Y,{modelValue:v.value,"onUpdate:modelValue":e[8]||(e[8]=o=>v.value=o),title:f(r).id?"更新角色":"添加角色",width:"30%",style:{"border-radius":"10px"}},{footer:t(()=>[de("span",ge,[l(u,{onClick:e[7]||(e[7]=o=>v.value=!1)},{default:t(()=>[p("取消")]),_:1}),l(u,{type:"primary",onClick:D},{default:t(()=>[p("确定")]),_:1})])]),default:t(()=>[l(N,{model:f(r),rules:B,ref_key:"form",ref:V},{default:t(()=>[l(w,{label:"角色名称",prop:"roleName"},{default:t(()=>[l(n,{placeholder:"请输入角色名称",modelValue:f(r).roleName,"onUpdate:modelValue":e[6]||(e[6]=o=>f(r).roleName=o),style:{width:"65%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(ee,{modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=o=>y.value=o),title:"分配权限",size:"30%"},{footer:t(()=>[l(u,{onClick:e[9]||(e[9]=o=>y.value=!1)},{default:t(()=>[p("取消")]),_:1}),l(u,{type:"primary",onClick:Q},{default:t(()=>[p("确定")]),_:1})]),default:t(()=>[l(Z,{ref_key:"tree",ref:U,data:f(S),"show-checkbox":"","node-key":"id","default-expanded-keys":[1],"default-checked-keys":f(q),props:J},null,8,["data","default-checked-keys"])]),_:1},8,["modelValue"])])}}});const ke=ce(ye,[["__scopeId","data-v-c4648082"]]);export{ke as default};
